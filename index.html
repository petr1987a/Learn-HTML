<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ö–æ–º–±–∞–π–Ω</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; line-height: 1.6; margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 30px auto; padding: 20px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; text-align: center; margin-bottom: 10px; min-height: 1.2em; font-size: 1.6em; }
        h2 { color: #0056b3; text-align: center; margin-top: 30px; margin-bottom: 15px; font-size: 1.3em; }
        textarea { width: 95%; min-height: 150px; margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; display: block; margin-left: auto; margin-right: auto; }
        button { padding: 10px 15px; font-size: 0.9rem; color: #ffffff; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; margin: 5px; }
        .button-container { text-align: center; margin-top: 15px; }
        #countButton, #clearButton { padding: 12px 35px; font-size: 1rem; }
        #countButton { background-color: #007bff; }
        #countButton:hover { background-color: #0056b3; }
        #clearButton { background-color: #6c757d; }
        #clearButton:hover { background-color: #5a6268; }
        #saveButton { background-color: #28a745; }
        #saveButton:hover { background-color: #218838; }
        #result { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-left: 5px solid #007bff; border-radius: 4px; font-family: 'Courier New', Courier, monospace; line-height: 1.8; }
        footer { margin-top: 60px; font-style: italic; text-align: center; font-size: 0.6em; color: #777; }
        .traffic-light-display { display: flex; justify-content: center; align-items: center; padding: 10px; height: 50px; }
        .traffic-light-display .light { width: 30px; height: 30px; border-radius: 50%; background-color: #D3D3D3; margin: 0 5px; transition: background-color 0.3s ease, box-shadow 0.3s ease; border: 2px solid #A9A9A9; box-shadow: inset 0 -2px 4px rgba(0,0,0,0.2); }
        .traffic-light-display .light.red-light.active { background-color: #FF0000; border-color: #B20000; box-shadow: 0 0 15px #FF0000, inset 0 -2px 4px rgba(0,0,0,0.4); }
        .traffic-light-display .light.yellow-light.active { background-color: #FFFF00; border-color: #B2B200; box-shadow: 0 0 15px #FFFF00, inset 0 -2px 4px rgba(0,0,0,0.4); }
        .traffic-light-display .light.green-light.active { background-color: #00FF00; border-color: #00B200; box-shadow: 0 0 15px #00FF00, inset 0 -2px 4px rgba(0,0,0,0.4); }
        #trafficLightComment { text-align: center; margin-top: 0px; margin-bottom: 20px; font-style: italic; color: #555; min-height: 1.5em; line-height: 1.5em; font-size: 0.9em; }
        #dictionaryHelper {
            margin-top: 40px;
            padding: 20px;
            background-color: #e9f5ff;
            border: 1px solid #b3d7ff;
            border-radius: 8px;
        }
        #dictionaryHelper h2 {
            margin-top: 0;
            color: #0056b3;
        }
        #dictionaryHelper input[type="text"] {
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        .search-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .search-buttons-container button.search-btn {
            background-color: #5bc0de;
        }
        .search-buttons-container button.search-btn:hover {
            background-color: #31b0d5;
        }
        #savedPoemsList {
            margin-top: 15px;
            list-style-type: none;
            padding: 0;
        }
      #savedPoemsList li {
    display: flex;
    justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏ */
    align-items: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
    padding: 8px 12px;
    margin-bottom: 5px;
    background-color: #f8f9fa;
    border-radius: 4px;
    font-size: 0.9em;
}

#savedPoemsList li span {
    flex-grow: 1; /* –ó–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∑–∞–Ω–∏–º–∞—Ç—å –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
    margin-right: 10px; /* –î–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ */
}

#savedPoemsList li button {
    font-size: 0.8em;
    padding: 4px 10px;
    margin-left: 5px; /* –î–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
}
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–£–¥–∞–ª–∏—Ç—å" */
    #savedPoemsList li button.delete-btn {
        background-color: #dc3545; /* –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç */
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    #savedPoemsList li button.delete-btn:hover {
        background-color: #c82333; /* –ë–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å" */
    #savedPoemsList li button.load-btn {
        background-color: #007bff; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç */
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-right: 5px;
    }
    #savedPoemsList li button.load-btn:hover {
        background-color: #0056b3; /* –ë–æ–ª–µ–µ —Ç—ë–º–Ω—ã–π —Å–∏–Ω–∏–π */
    }
</style>
</head>
<body>
<div class="container">
    <h1 id="mainPageTitle">–ó–∞–≥—Ä—É–∑–∫–∞ –ù–∞–∑–≤–∞–Ω–∏—è...</h1>
    <div id="trafficLightContainer" class="traffic-light-display">
        <span class="light red-light" id="lightRed"></span>
        <span class="light yellow-light" id="lightYellow"></span>
        <span class="light green-light" id="lightGreen"></span>
    </div>
    <div id="trafficLightComment">–°–≤–µ—Ç–æ—Ñ–æ—Ä –∂–¥—ë—Ç –≤–∞—à–∏—Ö —Ç–≤–æ—Ä–µ–Ω–∏–π... ‚ú®</div>
	<div class="button-container">
    <input type="text" id="rhythmPatternInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å—É–Ω–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 8,6,8,6)" style="width: 95%; margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem;">
</div>
    <textarea id="inputText" placeholder="–í–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å..."></textarea>
    <div class="button-container">
        <button id="countButton">START</button>
        <button id="clearButton">–û–ß–ò–°–¢–ò–¢–¨</button>
        <button id="saveButton">–°–û–•–†–ê–ù–ò–¢–¨</button>
    </div>
    <ul id="savedPoemsList"></ul>
    <div id="result">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç...</div>
    <div id="dictionaryHelper">
        <h2>–õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ö–æ–º–±–∞–π–Ω üî¨</h2>
        <input type="text" id="searchWordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...">
        <div class="search-buttons-container">
            <button class="search-btn" data-search-type="synonyms" title="–ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é —Å–ª–æ–≤–∞">–°–∏–Ω–æ–Ω–∏–º—ã</button>
            <button class="search-btn" data-search-type="rhymes" title="–ù–∞–π—Ç–∏ —Å–ª–æ–≤–∞, —Å–æ–∑–≤—É—á–Ω—ã–µ –≤ –∫–æ–Ω—Ü–µ">–†–∏—Ñ–º—ã</button>
            <button class="search-btn" data-search-type="meaning" title="–£–∑–Ω–∞—Ç—å —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–≤–∞">–ó–Ω–∞—á–µ–Ω–∏–µ</button>
            <button class="search-btn" data-search-type="antonyms" title="–ù–∞–π—Ç–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é —Å–ª–æ–≤–∞">–ê–Ω—Ç–æ–Ω–∏–º—ã</button>
            <button class="search-btn" data-search-type="etymology" title="–£–∑–Ω–∞—Ç—å –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—é —Å–ª–æ–≤–∞">–≠—Ç–∏–º–æ–ª–æ–≥–∏—è</button>
        </div>
    </div>
    <footer> –°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –ø–æ—ç—Ç–æ–≤ –õ–µ–Ω—ã –∏ –°–≤–µ—Ç—ã! </footer>
</div>

<script>
    const creativeTitles = [
        "–†–∏—Ç–º–æ–≥—Ä–∞—Ñ –ü–æ—ç–∑–∏–∏ üñåÔ∏è", "–ù–µ–π—Ä–æ–°–ª–æ–≥–æ–ú–µ—Ç—Ä ü§ñ", "–£–∫—Ä–æ—Ç–∏—Ç–µ–ª—å –°–ª–æ–≥–æ–≤ üé≠",
        "–ü–æ—ç—Ç–∏—á–µ—Å–∫–∏–π –ú–µ—Ç—Ä–æ–Ω–æ–º üé∂", "–î–æ–±—Ä—ã–π –°–≤–µ—Ç–æ—Ñ–æ—Ä—á–∏–∫üö¶ üòá", "–°–ª–æ–≥–æ-–ú–∞–≥–∏—è ‚ú®",
        "–ö–∞–º–µ—Ä—Ç–æ–Ω –ú—É–∑—ã üéµ", "–°–∏–ª–ª–∞–±–æ-–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä v0.1 ‚öõÔ∏è", "–°–ª–æ–≥–æ-–ù–∏–Ω–¥–∑—è: –ë–µ—Å—à—É–º–Ω—ã–π –°—á—ë—Ç! ü§∫"
    ];
    document.addEventListener('DOMContentLoaded', function() {
        const mainTitleElement = document.getElementById('mainPageTitle');
        if (mainTitleElement) {
            mainTitleElement.innerHTML = creativeTitles[Math.floor(Math.random() * creativeTitles.length)];
        }
    });

 // --- ‚≠ê –†–ê–°–®–ò–†–ï–ù–ù–´–ô –°–ü–ò–°–û–ö –®–ê–ë–õ–û–ù–û–í –†–ò–¢–ú–ò–ß–ï–°–ö–ò–• –†–ò–°–£–ù–ö–û–í ‚≠ê ---
const rhythmPatterns = [
    { name: "–ë–∞–ª–ª–∞–¥–∞ (8-6-8-6)", pattern: [8, 6, 8, 6] },
	{ name: "–î–æ–ª—å–Ω–∏–∫ (9-8-9-8)", pattern: [9, 8, 9, 8] },
    { name: "–°–æ–Ω–µ—Ç (10-10-10-10)", pattern: [10, 10, 10, 10] },
    { name: "–ß–µ—Ç—ã—Ä—ë—Ö—Å—Ç–æ–ø–Ω—ã–π —è–º–± (10-10-10-10)", pattern: [10, 10, 10, 10] },
    { name: "–•–æ–∫–∫—É (5-7-5)", pattern: [5, 7, 5] },
    { name: "–¢–∞–Ω–∫–∞ (5-7-5-7-7)", pattern: [5, 7, 5, 7, 7] },
    { name: "–û–∫—Ç–∞–≤–∞ (8-8-8-8-8-8-8-8)", pattern: [8, 8, 8, 8, 8, 8, 8, 8] },
    { name: "–ö–∞—Ç—Ä–µ–Ω (7-7-7-7)", pattern: [7, 7, 7, 7] },
    { name: "–≠–ª–µ–≥–∏—è (10-5-10-5)", pattern: [10, 5, 10, 5] },
    { name: "–†–æ–Ω–¥–æ (6-6-6-6)", pattern: [6, 6, 6, 6] },
    { name: "–î–∏—Å—Ç–∏—Ö (12-12)", pattern: [12, 12] },
    { name: "–ö–≤–∏–Ω—Ç–µ—Ç (5-5-5-5-5)", pattern: [5, 5, 5, 5, 5] },
    { name: "–°–µ–∫–≤–µ–Ω—Ü–∏—è (9-8-9-7-9-8-9-7)", pattern: [9, 8, 9, 7, 9, 8, 9, 7] },
    { name: "–†—É–±–∞–∏ (10-10-10-10)", pattern: [10, 10, 10, 10] },
    { name: "–ü–µ—Å–µ–Ω–Ω—ã–π —Ä–∏—Ç–º (6-8-6-8)", pattern: [6, 8, 6, 8] },
    { name: "–ß–µ—Ç–≤–µ—Ä–æ—Å—Ç–∏—à–∏–µ (8-8-6-6)", pattern: [8, 8, 6, 6] },
    { name: "–≠–ø–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ—Ñ–∞ (12-10-12-10)", pattern: [12, 10, 12, 10] },
    { name: "–õ–∏–º–µ—Ä–∏–∫ (9-9-6-6-9)", pattern: [9, 9, 6, 6, 9] },
    { name: "–î–æ–ª—å–Ω–∏–∫ (8-9-8-9)", pattern: [8, 9, 8, 9] },
    { name: "–ê–º—Ñ–∏–±—Ä–∞—Ö–∏–π (9-9-9-9)", pattern: [9, 9, 9, 9] },
    { name: "–•–æ—Ä–µ–π (8-8-8-8)", pattern: [8, 8, 8, 8] },
    { name: "–Ø–º–± (10-10-10-10)", pattern: [10, 10, 10, 10] },
    { name: "–î–∞–∫—Ç–∏–ª—å (11-11-11-11)", pattern: [11, 11, 11, 11] },
    { name: "–ê–Ω–∞–ø–µ—Å—Ç (12-12-12-12)", pattern: [12, 12, 12, 12] },
    { name: "–°–∞–ø—Ñ–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ—Ñ–∞ (11-11-11-5)", pattern: [11, 11, 11, 5] },
    { name: "–ê–ª–∫–∞–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–æ—Ñ–∞ (11-11-9-10)", pattern: [11, 11, 9, 10] },
    { name: "–¢—Ä—ë—Ö—Å—Ç–æ–ø–Ω—ã–π –∞–Ω–∞–ø–µ—Å—Ç (9-9-9)", pattern: [9, 9, 9] },
    { name: "–ü—è—Ç–∏—Å—Ç–æ–ø–Ω—ã–π —è–º–± (10-10-10-10-10)", pattern: [10, 10, 10, 10, 10] },
    { name: "–®–µ—Å—Ç–∏—Å—Ç–æ–ø–Ω—ã–π —Ö–æ—Ä–µ–π (12-12-12-12-12-12)", pattern: [12, 12, 12, 12, 12, 12] },
    { name: "–¢—Ä—ë—Ö—Å—Ç–æ–ø–Ω—ã–π –¥–∞–∫—Ç–∏–ª—å (11-11-11)", pattern: [11, 11, 11] },
    { name: "–°–∏–ª–ª–∞–±–∏—á–µ—Å–∫–∏–π —Å—Ç–∏—Ö (8-8-8-8)", pattern: [8, 8, 8, 8] },
    { name: "–¢—Ä—ë—Ö—Å—Ç–æ–ø–Ω—ã–π —Ö–æ—Ä–µ–π (6-6-6)", pattern: [6, 6, 6] },
    { name: "–ß–µ—Ç—ã—Ä—ë—Ö—Å—Ç–æ–ø–Ω—ã–π –∞–Ω–∞–ø–µ—Å—Ç (12-12-12-12)", pattern: [12, 12, 12, 12] },
    { name: "–°–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö (—Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≥–æ–≤)", pattern: [] }
];

    const textArea = document.getElementById('inputText');
    const countButton = document.getElementById('countButton');
    const resultDiv = document.getElementById('result');
    const clearButton = document.getElementById('clearButton');
    const saveButton = document.getElementById('saveButton');
    const trafficLightCommentDiv = document.getElementById('trafficLightComment');
    const lightRed = document.getElementById('lightRed');
    const lightYellow = document.getElementById('lightYellow');
    const lightGreen = document.getElementById('lightGreen');
    const vowels = "–∞–µ—ë–∏–æ—É—ã—ç—é—è";

    function resetTrafficLightsAndComment() {
        lightRed.classList.remove('active');
        lightYellow.classList.remove('active');
        lightGreen.classList.remove('active');
        trafficLightCommentDiv.textContent = "–°–≤–µ—Ç–æ—Ñ–æ—Ä –∂–¥—ë—Ç –≤–∞—à–∏—Ö —Ç–≤–æ—Ä–µ–Ω–∏–π... ‚ú®";
    }

    function countSyllablesInLine(line) {
        const lowerLine = line.toLowerCase();
        let syllableCount = 0;
        for (const char of lowerLine) {
            if (vowels.includes(char)) syllableCount++;
        }
        return syllableCount || 1;
    }

   function analyzeRhythmPattern(syllableCounts) {
    const rhythmInput = document.getElementById('rhythmPatternInput').value.trim();
    let expectedPattern = [];

    if (rhythmInput) {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –≤ –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª
        expectedPattern = rhythmInput.split(',').map(num => parseInt(num.trim(), 10));
    }

    if (expectedPattern.length > 0) {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª —Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å—É–Ω–æ–∫, —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å –Ω–∏–º
        let deviations = [];
        let totalDeviation = 0;

        for (let i = 0; i < expectedPattern.length; i++) {
            const deviation = (syllableCounts[i] || 0) - (expectedPattern[i] || 0);
            totalDeviation += Math.abs(deviation);
            deviations.push(deviation);
        }

        return {
            name: totalDeviation > 5 ? "–°–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö (—Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≥–æ–≤)" : "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–∏—Å—É–Ω–æ–∫",
            deviations
        };
    } else {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–≤—ë–ª —Ä–∏—Å—É–Ω–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
        let closestPattern = null;
        let smallestDeviation = Infinity;
        let deviations = [];

        for (const pattern of rhythmPatterns) {
            const { name, pattern: templatePattern } = pattern;
            if (templatePattern.length === 0) continue;

            let totalDeviation = 0;
            const currentDeviations = [];

            for (let i = 0; i < templatePattern.length; i++) {
                const deviation = (syllableCounts[i] || 0) - (templatePattern[i] || 0);
                totalDeviation += Math.abs(deviation);
                currentDeviations.push(deviation);
            }

            if (totalDeviation < smallestDeviation) {
                smallestDeviation = totalDeviation;
                closestPattern = name;
                deviations = currentDeviations;
            }
        }

        return {
            name: smallestDeviation > 5 ? "–°–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö (—Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≥–æ–≤)" : closestPattern,
            deviations
        };
    }
}
        let closestPattern = null;
        let smallestDeviation = Infinity;

        for (const pattern of rhythmPatterns) {
            const { name, pattern: expectedPattern } = pattern;
            if (expectedPattern.length === 0) continue;

            let totalDeviation = 0;
            for (let i = 0; i < expectedPattern.length; i++) {
                totalDeviation += Math.abs((syllableCounts[i] || 0) - expectedPattern[i]);
            }

            if (totalDeviation < smallestDeviation) {
                smallestDeviation = totalDeviation;
                closestPattern = name;
            }
        }

        return smallestDeviation > 5 ? "–°–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö (—Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≥–æ–≤)" : closestPattern;
    }

    function processAndDisplayResults() {
    const fullText = textArea.value.trim();
    resetTrafficLightsAndComment();

    if (!fullText) {
        resultDiv.innerHTML = "–ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–µ–≤—Å—Ç–≤–µ–Ω–Ω–æ —á–∏—Å—Ç–æ...";
        return;
    }

    const lines = fullText.split('\n');
    const syllableCounts = lines.map(line => countSyllablesInLine(line.trim()));
    const { name: rhythmName, deviations } = analyzeRhythmPattern(syllableCounts);

    resultDiv.innerHTML = lines.map((line, i) => {
        const deviation = deviations[i] || 0;
        let suggestion = "";

        if (deviation > 0) {
            suggestion = ` (—É–±–µ—Ä–∏—Ç–µ ${deviation} —Å–ª–æ–≥${deviation > 1 ? "–∞" : ""})`;
        } else if (deviation < 0) {
            suggestion = ` (–¥–æ–±–∞–≤—å—Ç–µ ${Math.abs(deviation)} —Å–ª–æ–≥${Math.abs(deviation) > 1 ? "–∞" : ""})`;
        }

        return `${line} (${syllableCounts[i]} —Å–ª–æ–≥–æ–≤)${suggestion}`;
    }).join('<br>');

    if (rhythmName !== "–°–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö (—Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≥–æ–≤)") {
        trafficLightCommentDiv.textContent = `${rhythmName} üéµ`;
        lightGreen.classList.add('active');
    } else {
        trafficLightCommentDiv.textContent = "–†–∏—Ç–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å—É–Ω–æ–∫ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö. ü§î";
        lightYellow.classList.add('active');
    }
}
        const fullText = textArea.value.trim();
        resetTrafficLightsAndComment();

        if (!fullText) {
            resultDiv.innerHTML = "–ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–µ–≤—Å—Ç–≤–µ–Ω–Ω–æ —á–∏—Å—Ç–æ...";
            return;
        }

        const lines = fullText.split('\n');
        const syllableCounts = lines.map(line => countSyllablesInLine(line.trim()));
        const rhythmName = analyzeRhythmPattern(syllableCounts);

        resultDiv.innerHTML = lines.map((line, i) => `${line} ${syllableCounts[i]}`).join('<br>');

        if (rhythmName !== "–°–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö (—Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≥–æ–≤)") {
            trafficLightCommentDiv.textContent = `${rhythmName} üéµ`;
            lightGreen.classList.add('active');
        } else {
            trafficLightCommentDiv.textContent = "–†–∏—Ç–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å—É–Ω–æ–∫ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–∏—Ö. ü§î";
            lightYellow.classList.add('active');
        }
    }

    countButton.addEventListener('click', processAndDisplayResults);
    clearButton.addEventListener('click', () => {
        textArea.value = "";
        resultDiv.innerHTML = "–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç...";
        resetTrafficLightsAndComment();
    });
	saveButton.addEventListener('click', () => {
    const fullText = textArea.value.trim();

    if (!fullText) {
        alert("–ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—É—Å—Ç–æ–µ. –ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å!");
        return;
    }

    const savedPoemsList = document.getElementById('savedPoemsList');
    const listItem = document.createElement('li');

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 50 —Å–∏–º–≤–æ–ª–æ–≤
    const previewText = fullText.length > 50 ? fullText.substring(0, 50) + "..." : fullText;

    const textSpan = document.createElement('span');
    textSpan.textContent = previewText;
    textSpan.style.cursor = "pointer";
    textSpan.title = "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å";

    // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
    const deleteButton = document.createElement('button');
    deleteButton.textContent = "–£–¥–∞–ª–∏—Ç—å";
    deleteButton.classList.add('delete-btn');
    deleteButton.addEventListener('click', () => {
        savedPoemsList.removeChild(listItem);
    });

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    const loadButton = document.createElement('button');
    loadButton.textContent = "–ó–∞–≥—Ä—É–∑–∏—Ç—å";
    loadButton.classList.add('load-btn');
    loadButton.addEventListener('click', () => {
        textArea.value = fullText;
        resultDiv.innerHTML = "–°—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ.";
        resetTrafficLightsAndComment();
    });

    listItem.appendChild(textSpan);
    listItem.appendChild(loadButton);
    listItem.appendChild(deleteButton);
    savedPoemsList.appendChild(listItem);

    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    textArea.value = "";
    resultDiv.innerHTML = "–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç...";
    resetTrafficLightsAndComment();
});
</script>
</body>
</html>
